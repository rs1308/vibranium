#!/usr/bin/env bash

TAG=$(git -C "$VIBRANIUM" describe --tags --abbrev=0 2>/dev/null)
HEAD=$(git -C "$VIBRANIUM" rev-parse HEAD)
TAG_COMMIT=$(git -C "$VIBRANIUM" rev-list -n 1 "$TAG")

if [ "$HEAD" = "$TAG_COMMIT" ]; then
    echo "Vibranium ${TAG} release"
else
    COMMITS_AHEAD=$(git -C "$VIBRANIUM" rev-list --count "$TAG"..HEAD)

    git -C "$VIBRANIUM" fetch --quiet origin >/dev/null 2>&1
    echo "Vibranium ${TAG}. Development branch, ${COMMITS_AHEAD} commits ahead of latest stable release"
	exit 0
fi

if [ -f "$VIBRANIUM_STATE/update.available" ]; then
    echo "New version available: $(<"$VIBRANIUM_STATE/update.available")"
else
	echo "You are up to date"
fi
