#!/usr/bin/env bash

source "$VIBRANIUM_PATH/vibranium-core-lib"

OPTIONS=(
	"Package Management"
	"Vibranium Settings"
	"Utilities" "Help"
)

if [ -f "$VIBRANIUM_STATE/update.available" ]; then
	OPTIONS+=(
		"<b><i>Update Vibranium to <span foreground='${P_ACCENT}'>""$(<"$VIBRANIUM_STATE/update.available")""</span></i></b>"
	)
fi

INDEX=0

while :; do
	CHOSEN="$(printf "%s\n" "${OPTIONS[@]}" | rofi_cmd "Vibranium" "ESC to exit" -selected-row "$INDEX")"
    [ -z "$CHOSEN" ] && break

    for i in "${!OPTIONS[@]}"; do
        if [ "${OPTIONS[$i]}" == "$CHOSEN" ]; then
            INDEX="$i"
            break
        fi
    done

    case "$CHOSEN" in
		*"Update"*)
			if vibranium-update; then
				vibranium-cmd-kill-rofi
			fi
			;;
        "Vibranium Settings")
			index=0
            while :; do
                vibranium_opts=("Configure Waybar" "Configure Vibranium")
                vibranium_chosen="$(printf "%s\n" "${vibranium_opts[@]}" | rofi_cmd "${CHOSEN[0]}" "ESC to go back" -selected-row "$index")"
                [ -z "$vibranium_chosen" ] && break

				for i in "${!vibranium_opts[@]}"; do
					if [ "${vibranium_opts[$i]}" == "$vibranium_chosen" ]; then
						index="$i"
						break
					fi
				done

                case "$vibranium_chosen" in
                    "Configure Waybar")    "$VIBRANIUM_PATH/configure/waybar-main-menu"    ;;
                    "Configure Vibranium") "$VIBRANIUM_PATH/configure/vibranium-main-menu" ;;
                esac
            done
            ;;
		"Help")
			vibranium-menu-help
			;;
        "Package Management")
            vibranium-menu-package-management
            ;;
        "Utilities")
            vibranium-menu-utilities
            ;;
        *)
            continue
            ;;
    esac
done
