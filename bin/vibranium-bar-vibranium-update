#!/usr/bin/env bash

source "$XDG_CONFIG_HOME/vibranium/theme/current/vibranium-lib-theme"

if [ -f "$VIBRANIUM_STATE/update.available" ]; then

    while ! ping 8.8.8.8 -c 1 &> /dev/null; do
        # No internet connection
        sleep 1
    done

    icon="<span foreground='${P_GREEN}'>\uf071</span>"
    tag="$(< "$VIBRANIUM_STATE/update.available")"
    tooltip="<span foreground='${P_ACCENT}'><b>Vibranium</b></span> "
    tooltip+="update available!\n"
    tooltip+="<span foreground='${P_ACCENT}'><b>New version</b></span>: <b>${tag}</b>\n"
    tooltip+="<span foreground='${P_YELLOW}'><b>Click here to update</b></span>"
    printf '{"text": "%s", "tooltip": "%s" }' "$icon" "$tooltip"
    exit 0
fi

printf '{"text": ""}'
