#!/usr/bin/env bash

# shellcheck disable=SC2016
REMOTE_LATEST=$(git -C "$VIBRANIUM" ls-remote --tags origin | sed -n '/refs\/tags\/[^^]*$/ { s#.*refs/tags/##; h }; ${x; p}')
LOCAL_LATEST=$(git -C "$VIBRANIUM" describe --tags --abbrev=0 2>/dev/null)

if [[ "$REMOTE_LATEST" != "$LOCAL_LATEST" ]]; then
	echo "$REMOTE_LATEST" > "$VIBRANIUM_STATE/update.available"
	vibranium-cmd-refresh-waybar-module vibranium-update
	exit 0 # update available
else
	exit 1 # up to date
fi
