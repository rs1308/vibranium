#!/usr/bin/env bash

TARGET="$XDG_CONFIG_HOME/chromium-flags.conf"

[ -z "$1" ] && exit 1

case "$1" in
    enable)
        if ! grep -q "oauth2" "$TARGET"; then
            echo "--oauth2-client-id=77185425430.apps.googleusercontent.com" >> "$TARGET"
            echo "--oauth2-client-secret=OTJgUOQcT7lO7GsGZq2G4IlT" >> "$TARGET"

            if pkill -0 chromium; then
                notify-send -r 1 "Vibranium" "Google sync support enabled\n<b>Please restart your browser</b>"
            else
                notify-send -r 1 "Vibranium" "Google sync support enabled\n<b>Open your browser to start syncing</b>"
            fi
        fi
        ;;
    disable)
        if grep -q "oauth2" "$TARGET"; then
            sed -i '/--oauth2/d' "$TARGET"

            if pkill -0 chromium; then
                notify-send -r 1 "Vibranium" "Google sync support disbaled\n<b>Please restart your browser</b>"
            else
                notify-send -r 1 "Vibranium" "Google sync support disabled"
            fi
        fi
        ;;
esac

vibranium-cmd-kill-rofi
