#!/usr/bin/env bash

source "$XDG_CONFIG_HOME/vibranium/theme/current/vibranium-lib-theme"

_set_city() {
	local opt city

	opt="VIBRANIUM_BAR_WEATHER_MODULE_CITY"

	if ! curl -s --max-time 5 -I --fail https://clients3.google.com/generate_204 >/dev/null; then
		return 1
	fi

	city="$(curl -s --max-time 5 http://ip-api.com/json | jq -r '.city')"

	"$VIBRANIUM_PATH"/configure/option-validate "$opt"
	sed -i "s|^${opt}=.*|${opt}=\"${city}\"|" \
		"$XDG_CONFIG_HOME/vibranium/settings"
}

msg+="\nPress <span foreground='${P_YELLOW}'><b>SUPER + A</b></span>      to open app launcher\n"
msg+="Press <span foreground='${P_YELLOW}'><b>CTRL + ALT + V</b></span> to open Vibranium menu\n"
msg+="Press <span foreground='${P_YELLOW}'><b>CTRL + ALT + K</b></span> to view all keyboard shortcuts\n\n"
msg+="<b>Right-click</b> to dismiss this notification"
notify-send -r 1 -t 1800000 "Welcome to Vibranium" "$msg"

chromium --no-startup-window --set-theme-color="25, 35, 48" &

_set_city

rm "$VIBRANIUM_STATE/first-boot"
