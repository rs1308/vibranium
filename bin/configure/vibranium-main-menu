#!/bin/bash

source "$VIBRANIUM_PATH/vibranium-core-lib"
export PATH="$PATH:$VIBRANIUM_PATH/configure"

OPTIONS=("Idle" "Audio" "General" "Set font" "Hyprland" "Set theme" "Recording" "Brightness" "Screenshots" "Night Light" "Color Picker" "Factory Reset")
INDEX=0

_hyprland() {
	local hypr_index=0

	while :; do
		hyprland_opts=("Input" "Appearance" "Edit configs" "<b>Advanced</b>")
		hyprland_chosen="$(printf "%s\n" "${hyprland_opts[@]}" | rofi_cmd "Hyprland" "ESC to go back" -selected-row "$hypr_index")"
		[[ -z $hyprland_chosen ]] && break

		for i in "${!hyprland_opts[@]}"; do
			if [ "${hyprland_opts[$i]}" == "$hyprland_chosen" ]; then
				hypr_index="$i"
				break
			fi
		done

		case "$hyprland_chosen" in
			"Appearance")
				configure-wm-appearance
				;;
			*"Advanced"*)
				configure-wm-advanced
				;;
			"Input")
				configure-wm-input
				;;
			"Edit configs")
				while :; do
					edit_configs_opts=(
						"Input devices"
						"Window rules"
						"Keybindings"
						"Monitors"
					)
					edit_configs_chosen="$(printf "%s\n" "${edit_configs_opts[@]}" | rofi_cmd "Edit" "ESC to go back")"
					[[ -z $edit_configs_chosen ]] && break

					case "$edit_configs_chosen" in
						"Input devices") vibranium-cmd-launch-terminal "$EDITOR" "$XDG_CONFIG_HOME/hypr/hyprland.conf.d/input.conf" ;;
						"Window rules")  vibranium-cmd-launch-terminal "$EDITOR" "$XDG_CONFIG_HOME/hypr/hyprland.conf.d/window-rules.conf" ;;
						"Keybindings")   vibranium-cmd-launch-terminal "$EDITOR" "$XDG_CONFIG_HOME/hypr/hyprland.conf.d/binds.conf" ;;
						"Monitors")      vibranium-cmd-launch-terminal "$EDITOR" "$XDG_CONFIG_HOME/hypr/hyprland.conf.d/monitors.conf" ;;
					esac
					vibranium-cmd-kill-rofi
				done
			;;
		esac
	done
}

while :; do
	CHOSEN="$(printf "%s\n" "${OPTIONS[@]}" | rofi_cmd "Vibranium" "ESC to go back" -selected-row "$INDEX"  -theme-str 'listview{lines: 15;}')"
	[ -z "$CHOSEN" ] && break

    for i in "${!OPTIONS[@]}"; do
        if [ "${OPTIONS[$i]}" == "$CHOSEN" ]; then
            INDEX="$i"
            break
        fi
    done

	case "$CHOSEN" in
		"Set font")
			vibranium-font-set
			;;
		"Idle")
			configure-idle
			;;
		"Audio")
			configure-audio
			;;
		"Screenshots")
			configure-screenshots
			;;
		"Brightness")
			configure-brightness
			;;
		"Recording")
			configure-recording
			;;
		"Night Light")
			configure-night-light
			;;
		"Color Picker")
			configure-color-picker
			;;
		"Set theme")
			if vibranium-theme-set; then
				vibranium-cmd-kill-rofi
				exit 0
			fi
			;;
		"General")
			configure-global-options
			;;
		"Hyprland")
			_hyprland
			;;
		"Factory Reset")
			factory-reset
			;;
	esac
done
